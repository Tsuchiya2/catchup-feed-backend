# ============================================================
# catchup-feed - 環境変数サンプル（本番環境用）
# ============================================================
# このファイルをコピーして .env を作成してください
# cp .env.example .env
# ============================================================

# ------------------------------------------------------------
# PostgreSQL データベース設定
# ------------------------------------------------------------
POSTGRES_USER=catchup
POSTGRES_PASSWORD=secret
POSTGRES_DB=catchup

# データベース接続URL（Docker Compose使用時）
# ホスト名は docker-compose.yml の service 名と一致させる
DATABASE_URL=postgres://catchup:secret@postgres:5432/catchup?sslmode=disable

# ------------------------------------------------------------
# 要約エンジン設定
# ------------------------------------------------------------
# 使用する要約エンジンを選択 (openai または claude)
# デフォルト: claude
SUMMARIZER_TYPE=claude

# ------------------------------------------------------------
# OpenAI API 設定 (SUMMARIZER_TYPE=openai の場合に使用)
# ------------------------------------------------------------
# OpenAI API キーを設定
# 取得方法: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ------------------------------------------------------------
# Anthropic Claude API 設定 (SUMMARIZER_TYPE=claude の場合に使用)
# ------------------------------------------------------------
# Anthropic API キーを設定
# 取得方法: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ------------------------------------------------------------
# JWT 認証設定
# ------------------------------------------------------------
# JWT トークンの署名に使用する秘密鍵
# セキュリティ要件:
#   - 最小32文字（256ビット）必須
#   - ランダムな文字列を使用（以下のコマンドで生成可能）
#     openssl rand -base64 64
JWT_SECRET=your-super-secret-jwt-key-min-32-chars-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ------------------------------------------------------------
# 管理者アカウント設定
# ------------------------------------------------------------
# 管理者のユーザー名
# 要件:
#   - 空白は許可されません（起動時にバリデーションされます）
ADMIN_USER=admin

# 管理者のパスワード
# セキュリティ要件（起動時に検証されます）:
#   - 最小12文字必須
#   - 空白は許可されません
#   - 以下の弱いパスワードは使用できません:
#     admin, password, 123456, secret, test, default, root など
#   - 単純な数字のパターンは使用できません（例: 111111111111, 123456789012）
#   - キーボードパターンは使用できません（例: qwerty, asdfgh）
#   - 推奨: 大文字・小文字・数字・記号を組み合わせた複雑なパスワード
#   - 例（生成方法）: openssl rand -base64 24
ADMIN_USER_PASSWORD=your-strong-password-here

# ------------------------------------------------------------
# Viewer (Demo) Account Settings (Optional)
# ------------------------------------------------------------
# Viewer role provides read-only access (GET requests only) for demo purposes.
# If not configured, the system runs in admin-only mode.
#
# Use cases:
# - Portfolio demonstrations to recruiters
# - Read-only monitoring dashboards
# - Guest access for API exploration

# Viewer email address (optional)
# Requirements:
#   - Must differ from ADMIN_USER
#   - If set, DEMO_USER_PASSWORD is required
# Example: demo@example.com
# DEMO_USER=

# Viewer password (required if DEMO_USER is set)
# Security Requirements (same as admin):
#   - Minimum 12 characters required
#   - Cannot be a weak password (password, 123456, etc.)
# Example generation: openssl rand -base64 24
# DEMO_USER_PASSWORD=

# Graceful Degradation:
# If viewer credentials are misconfigured (e.g., weak password, same as admin),
# the system will:
#   1. Log a warning message
#   2. Disable the viewer role
#   3. Continue running in admin-only mode
# This ensures the application never fails to start due to viewer configuration.

# ------------------------------------------------------------
# Discord通知設定（オプション）
# ------------------------------------------------------------
# Discord通知を有効にする場合は true に設定
# デフォルト: false
DISCORD_ENABLED=false

# Discord Webhook URL
# 取得方法: Discordサーバー設定 > 連携サービス > ウェブフック
# 形式: https://discord.com/api/webhooks/{webhook_id}/{webhook_token}
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN

# ------------------------------------------------------------
# Slack通知設定（オプション）
# ------------------------------------------------------------
# Slack通知を有効にする場合は true に設定
# デフォルト: false
SLACK_ENABLED=false

# Slack Webhook URL
# 取得方法: Slack App設定 > Incoming Webhooks
# 形式: https://hooks.slack.com/services/{workspace_id}/{channel_id}/{token}
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ------------------------------------------------------------
# 通知システム共通設定（オプション）
# ------------------------------------------------------------
# 最大同時通知数（範囲: 1-100）
# デフォルト: 10
# 通知の並行実行数を制限します。値が大きいほど通知が速くなりますが、
# リソース使用量も増加します。
# NOTIFY_MAX_CONCURRENT=10

# メトリクスHTTPサーバーのポート（範囲: 1025-65535）
# デフォルト: 9090
# Prometheusメトリクスとヘルスチェックエンドポイントを提供するHTTPサーバーのポート番号
# エンドポイント: /metrics, /health, /health/channels
# METRICS_PORT=9090

# ------------------------------------------------------------
# オプション設定
# ------------------------------------------------------------
# アプリケーションバージョン（Docker ビルド時に上書き可能）
# VERSION=1.0.0

# ログレベル（debug, info, warn, error）
# デフォルト: info
# LOG_LEVEL=debug

# ビルド日時（Docker ビルド時に自動設定）
# BUILD_DATE=2025-10-26T00:00:00Z

# ------------------------------------------------------------
# Worker Configuration
# ------------------------------------------------------------
# Cron schedule for worker job execution (default: "30 5 * * *" = 5:30 AM daily)
# Format: "minute hour day month weekday"
# Examples:
#   "30 5 * * *"   - 5:30 AM daily
#   "0 */6 * * *"  - Every 6 hours
#   "0 9,17 * * *" - 9:00 AM and 5:00 PM daily
# Default: "30 5 * * *"
# Fallback: If invalid, uses default "30 5 * * *" (warning logged)
# Validation: https://crontab.guru/
# CRON_SCHEDULE=30 5 * * *

# Timezone for cron schedule (default: Asia/Tokyo)
# Must be a valid IANA timezone (e.g., America/New_York, Europe/London, UTC)
# Default: Asia/Tokyo
# Fallback: If invalid, uses "Asia/Tokyo" or UTC (warning logged)
# DST: Automatically handled by cron library
# Note: Requires tzdata in Docker image
# TZ=Asia/Tokyo

# Maximum concurrent notification goroutines (default: 10)
# Range: 1-100
# Higher values = faster notifications but more resource usage
# NOTIFY_MAX_CONCURRENT=10

# Timeout for entire crawl job (default: 30m)
# Format: duration string (e.g., "30m", "1h", "90m")
# Must be positive
# Recommended: 30m-60m for typical workloads
# Default: 30m
# Fallback: If invalid or negative, uses "30m" (warning logged)
# CRAWL_TIMEOUT=30m

# Health check server port (default: 9091)
# Range: 1024-65535
# Endpoints: /health (liveness), /health/ready (readiness)
# Note: Metrics are on port 9090 (separate server)
# WORKER_HEALTH_PORT=9091

# ------------------------------------------------------------
# Worker Observability
# ------------------------------------------------------------
# Metrics endpoint: http://localhost:9090/metrics (Prometheus format)
# Health check: http://localhost:9091/health
# Readiness check: http://localhost:9091/health/ready
#
# Key metrics:
#   - worker_config_fallback_active: 1 if fallback is active
#   - worker_cron_job_runs_total: Total job executions by status
#   - worker_cron_job_duration_seconds: Job execution time
#   - worker_cron_job_feeds_processed_total: Total feeds processed
#   - worker_cron_job_last_success_timestamp: Last successful job time
#
# Monitoring:
#   - See docs/operations/worker-configuration.md for operations guide
#   - Alert rules: monitoring/alerts/worker-config.yml
#   - Prometheus scrape config: monitoring/prometheus.yml

# ------------------------------------------------------------
# CORS Configuration
# ------------------------------------------------------------
# Cross-Origin Resource Sharing (CORS) allows the frontend application
# to communicate with the backend API from different origins.

# Allowed origins for cross-origin requests (REQUIRED)
# Format: Comma-separated list of allowed origins
# Requirements:
#   - Must include scheme (http:// or https://)
#   - Must NOT include trailing slashes
#   - No spaces around commas
#   - Each origin must be a valid URL
# Security: DO NOT use wildcard (*) with credentials (JWT authentication)

# Development (local frontend):
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# Production (example - replace with your actual domains):
# CORS_ALLOWED_ORIGINS=https://pulse.catchup-feed.com,https://catchup-feed-web.vercel.app

# Optional: Allowed HTTP Methods
# Default: GET,POST,PUT,DELETE,PATCH,OPTIONS
# Only customize if you need to restrict methods
# CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS

# Optional: Allowed Request Headers
# Default: Content-Type,Authorization,X-Request-ID
# Only customize if you need additional headers
# CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Request-ID

# Optional: Preflight Cache Duration (in seconds)
# Default: 86400 (24 hours)
# How long browsers can cache preflight OPTIONS responses
# Typical values: 3600 (1 hour), 86400 (24 hours)
# CORS_MAX_AGE=86400

# ------------------------------------------------------------
# Rate Limiting Configuration
# ------------------------------------------------------------
# Protects the API from DoS attacks, brute-force attempts, and abuse.
# Two types of rate limiting are implemented:
#   1. IP-based: Limits requests from a single IP address
#   2. User-based: Limits requests from an authenticated user

# Enable/disable rate limiting globally (default: true)
# Set to false to disable rate limiting (not recommended in production)
RATELIMIT_ENABLED=true

# IP-based rate limiting (enforced before authentication)
# Limits the number of requests from a single IP address
RATELIMIT_IP_ENABLED=true

# Maximum requests per IP address (default: 100)
# Range: 1-10000
# Production: 100 req/min
# Development: 1000 req/min (for easier testing)
RATELIMIT_IP_LIMIT=100

# Time window for IP-based rate limiting (default: 1m)
# Format: duration string (e.g., "1m", "60s", "1h")
# Must be positive
RATELIMIT_IP_WINDOW=1m

# User-based rate limiting (enforced after authentication)
# Limits the number of requests from an authenticated user
RATELIMIT_USER_ENABLED=true

# Maximum requests per user (default: 1000)
# Range: 1-100000
# Production: 1000 req/hour
# Development: 10000 req/hour (for easier testing)
RATELIMIT_USER_LIMIT=1000

# Time window for user-based rate limiting (default: 1h)
# Format: duration string (e.g., "1h", "60m", "3600s")
# Must be positive
RATELIMIT_USER_WINDOW=1h

# Tier-based rate limiting (per hour)
# Different user tiers have different rate limits
# These override RATELIMIT_USER_LIMIT for the respective tier

# Admin tier: Highest limit for administrators (default: 10000)
RATELIMIT_TIER_ADMIN=10000

# Premium tier: Higher limit for premium users (default: 5000)
RATELIMIT_TIER_PREMIUM=5000

# Basic tier: Standard limit for basic users (default: 1000)
RATELIMIT_TIER_BASIC=1000

# Viewer tier: Lower limit for read-only users (default: 500)
RATELIMIT_TIER_VIEWER=500

# Memory management
# Maximum number of active keys (IPs or users) to track in memory
# When exceeded, oldest keys are evicted (LRU policy)
# Range: 100-100000
# Production: 10000 (supports ~10,000 concurrent IPs)
# Development: 5000 (lower memory usage)
RATELIMIT_MAX_KEYS=10000

# Cleanup interval for removing expired rate limit state
# Format: duration string (e.g., "5m", "300s", "10m")
# Must be positive
# Default: 5m (cleanup every 5 minutes)
RATELIMIT_CLEANUP_INTERVAL=5m

# Circuit breaker configuration
# Prevents rate limiter failures from cascading to the entire system

# Number of consecutive failures before circuit opens (default: 10)
# When open, rate limiting is disabled (fail-open behavior)
# Range: 1-100
RATELIMIT_CB_FAILURE_THRESHOLD=10

# Time to wait before attempting to reset circuit breaker (default: 30s)
# Format: duration string (e.g., "30s", "1m", "60s")
# Must be positive
RATELIMIT_CB_RECOVERY_TIMEOUT=30s

# Trusted proxies for IP extraction
# Comma-separated list of CIDR ranges
# Used to extract real client IP from X-Forwarded-For header
# Security: Only trust proxies you control (e.g., load balancers)
# Examples:
#   - Private networks: 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
#   - AWS ELB: 10.0.0.0/8
#   - Cloudflare: See https://www.cloudflare.com/ips/
# Default: Private networks
RATELIMIT_TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# ------------------------------------------------------------
# Content Security Policy (CSP) Configuration
# ------------------------------------------------------------
# CSP helps prevent XSS attacks, content injection, and other code injection attacks
# by controlling which resources the browser is allowed to load.

# Enable/disable CSP headers (default: true)
# Set to false to disable CSP (not recommended in production)
CSP_ENABLED=true

# CSP report-only mode (default: false)
# When true, violations are reported but not enforced
# Useful for testing CSP policies before enforcing them
# Production: false (enforce CSP)
# Development: true (report violations, don't block)
CSP_REPORT_ONLY=false

# ------------------------------------------------------------
# Rate Limiting Observability
# ------------------------------------------------------------
# Metrics endpoint: http://localhost:8080/metrics (Prometheus format)
# Health check: http://localhost:8080/health (includes rate limiter status)
#
# Key metrics:
#   - http_rate_limit_violations_total: Total violations by limiter type
#   - http_rate_limit_check_duration_seconds: Latency of rate limit checks
#   - http_rate_limit_active_keys: Number of active keys in memory
#   - http_rate_limit_circuit_state: Circuit breaker state (0=closed, 1=open)
#   - http_rate_limit_degradation_level: Current degradation level
#   - http_rate_limit_evictions_total: Total LRU evictions
#
# Monitoring:
#   - See docs/operations/rate-limiting-monitoring.md for operations guide
#   - Alert rules: deployments/prometheus/alerts/rate-limiting.yml

# ============================================================
# 将来実装予定の機能
# ============================================================
# 以下の機能は現在未実装です。将来のバージョンで追加予定です。

# Email Notification Configuration (未実装)
# Email通知機能は現在開発中です
# EMAIL_ENABLED=false
# EMAIL_FROM=noreply@example.com
# EMAIL_TO=admin@example.com
# EMAIL_SMTP_SERVER=smtp.gmail.com
# EMAIL_SMTP_PORT=587
